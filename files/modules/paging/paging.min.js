this.init=function(f){var c=this,e=this,j=function(){e.page(0)};this.query.page={max:2,page:0,skip:parseInt(f.page,10)||0,limit:parseInt(f.limit,10)||8};this.paging={page:N.dom.find(f.page,this.inst.dom),of:N.dom.find(f.of,this.inst.dom),forw:N.dom.find(f.forw,this.inst.dom),back:N.dom.find(f.back,this.inst.dom),cont:N.dom.find(f.container,this.inst.dom)};var k=function(c,e,b){if(e)for(var d=0,i=e.length;d<i;++d)e[d].bind("click",function(d){return function(){c.page(b,function(){c.obs.f("pagingDone",d)})}}(e[d]))};f.forw&&k(e,this.paging.forw,1);f.back&&k(e,this.paging.back,-1);e.of&&e.count(function(h,f){if(!h){var b=e.query.page.max=Math.ceil(f/e.query.page.limit);if(b>1){for(var d=0,i=c.paging.forw.length;d<i;++d)e.paging.forw[d].style.display="block";d=0;for(i=c.paging.back.length;d<i;++d)e.paging.back[d].style.display="block"}else{d=0;for(i=c.paging.forw.length;d<i;++d)e.paging.forw[d].style.display="none";d=0;for(i=c.paging.back.length;d<i;++d)e.paging.back[d].style.display="none"}d=0;for(i=e.paging.of.length;d<i;++d)e.paging.of[d].innerHTML=b||1}});c.obs.l("findStart",j);c.obs.l("findEmpty",function(){for(var h=0,f=c.paging.cont.length;h<f;++h)e.paging.cont[h].style.display="none"});c.obs.l("findData",function(){for(var h=0,f=c.paging.cont.length;h<f;++h)e.paging.cont[h].style.display="block"});this.page=function(h,e){var b=this;if(b.query.page)if(h==0){b.query.page.skip=0;for(var d=b.query.page.page=0,f=b.paging.page.length;d<f;++d)b.paging.page[d].innerHTML=1;c.count(function(d,e){var h=c.query.page.max=Math.ceil(e/c.query.page.limit);if(h>1){for(var a=0,g=c.paging.forw.length;a<g;++a)b.paging.forw[a].style.display="block";a=0;for(g=c.paging.back.length;a<g;++a)b.paging.back[a].style.display="block"}else{a=0;for(g=c.paging.forw.length;a<g;++a)b.paging.forw[a].style.display="none";a=0;for(g=c.paging.back.length;a<g;++a)b.paging.back[a].style.display="none"}if(!d){a=0;for(g=c.paging.of.length;a<g;++a)c.paging.of[a].innerHTML=h||1}});e&&e()}else b.query.page.page+h>-1&&b.query.page.page+h<b.query.page.max&&b.count(function(d,e){var f=b.query.page.max=Math.ceil(e/b.query.page.limit);if(f>1){for(var a=0,g=c.paging.forw.length;a<g;++a)b.paging.forw[a].style.display="block";a=0;for(g=c.paging.back.length;a<g;++a)b.paging.back[a].style.display="block"}else{a=0;for(g=c.paging.forw.length;a<g;++a)b.paging.forw[a].style.display="none";a=0;for(g=c.paging.back.length;a<g;++a)b.paging.back[a].style.display="none"}a=0;for(g=b.paging.of.length;a<g;++a)b.paging.of[a].innerHTML=f||1;if(b.query.page.page+h<b.query.page.max){f=(b.query.page.page+=h)+1;a=0;for(g=b.paging.page.length;a<g;++a)b.paging.page[a].innerHTML=f;b.obs.f("pagingStart",b.query.page);b.query.page.skip=h?b.query.page.limit*b.query.page.page:h;c.obs.r("findStart",j);c.find(function(){c.obs.l("findStart",j)})}})};this.query.handlers.page=function(e){if(c.query.page){if(c.query.page.skip)e.options.skip=c.query.page.skip;if(c.query.page.limit)e.options.limit=c.query.page.limit;c.query.sorted=1}return e}};