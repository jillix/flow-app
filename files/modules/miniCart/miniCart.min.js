this.init=function(f){var e=this,l=N.dom.findOne(f.items,e.inst.dom),j=N.dom.findOne(f.empty,e.inst.dom),k=N.dom.findOne(f.thanks,e.inst.dom),n=N.dom.findOne(f.total,e.inst.dom),g=N.dom.findOne(f.order,e.inst.dom),c=N.dom.findOne(f.agb,e.inst.dom),h=[],b={},i=0,m;this.obs.l("addItem",function(a){if(a.number){if(b[a._c])b[a._c].number+=parseInt(a.number,10)||1;else{m&&clearTimeout(m);b[a._c]={};for(var d in a)b[a._c][d]=a[d];l.style.display="block";j.style.display="none";k.style.display="none"}e.obs.f("updateTotal",a)}});this.obs.l("renderItems",function(){e.render(h,1)});this.obs.l("remItem",function(a){b[a._c]&&delete b[a._c];e.obs.f("updateTotal",a);if(h.length<1)j.style.display="block",l.style.display="none",k.style.display="none",c.remAttr({"class":"active"}),g.addAttr({"class":"inactive"});e.obs.f("renderItems")});this.obs.l("updateTotal",function(a,d,c){if(b[a._c])c||(c={}),d=parseInt(c.value||b[a._c].number,10)||"",d>b[a._c].stock?c.value=b[a._c].number=b[a._c].stock:(c.value=d,b[a._c].number=d||1);i=0;h=[];for(var f in b)i+=b[f].number*b[f].netto,h.push(b[f]);n.innerHTML=i.toFixed(2);e.obs.f("renderItems")});g&&g.bind("click",function(){if(c&&c.getAttribute("class").indexOf("active")>-1){var a={total:i,items:[]},d;for(d in b)a.items.push({_c:b[d]._c,caption:b[d].caption,netto:b[d].netto,nr:b[d].nr,stock:b[d].stock,number:b[d].number});N.link({url:"/order",data:a},function(a){a&&alert("Error");h=[];b={};i=0;k.style.display="block";l.style.display="none";j.style.display="none";c.remAttr({"class":"active"});g.addAttr({"class":"inactive"});m=setTimeout(function(){j.style.display="block";k.style.display="none"},8888)})}});c&&c.bind("click",function(){c.getAttribute("class").indexOf("active")>-1?(c.remAttr({"class":"active"}),g.addAttr({"class":"inactive"})):(c.addAttr({"class":"active"}),g.remAttr({"class":"inactive"}))})};